# BlueHeron.Collections.CharTrie

## TODO

1. Refactor Node.Character to Node.Characters char array to compress branches with one child into a single node (cf. a HAT-Trie)

## Nodes as class

## Debug Trace:
|--------|------------|--------------|
| Object |    # Nodes |         Size |
|--------|------------|--------------|
|   List |     374622 |   26494112 B | <!--  25.3 Mb
|--------|------------|--------------|
|   Trie |    1201451 |  619148320 B | <!-- 590.5 Mb -> 23 times larger!
|--------|------------|--------------|

|----------------------|--------|-----------------|-----------------|-----------------|----------------|
|            Operation | # Runs | Minimum (µsec.) | Maximum (µsec.) | Average (µsec.) | Median (µsec.) |
|----------------------|--------|-----------------|-----------------|-----------------|----------------|
|        List Contains |    375 |             0,4 |          2409,4 |           825,4 |         1208,7 |
|        Trie Contains |    375 |             1,3 |            37,9 |             4,8 |           22,2 | <!-- OK
|----------------------|--------|-----------------|-----------------|-----------------|----------------|
|      List StartsWith |     10 |        101739,8 |        115426,4 |        107854,5 |       106189,8 |
|    Trie Find(prefix) |     10 |           107,4 |          5506,0 |          1521,1 |         1752,9 | <!-- OK
|----------------------|--------|-----------------|-----------------|-----------------|----------------|
|           List Regex |      3 |         70886,8 |         85303,2 |         79376,7 |        81940,1 |
|   Trie Find(pattern) |      3 |         81680,2 |         82658,8 |         82228,8 |        81680,2 | <!-- Not OK
|----------------------|--------|-----------------|-----------------|-----------------|----------------|

## Nodes as struct

### Debug Trace:
|--------|------------|--------------|
| Object |    # Nodes |         Size |
|--------|------------|--------------|
|   List |     374614 |   26348248 B | <!-- removed 6 duplicate words from nl.dic (negligible effect on performance)
|--------|------------|--------------|
|   Trie |    1201446 |  397864528 B | <!-- 35% reduction, but still too large
|--------|------------|--------------|

|----------------------|--------|-----------------|-----------------|-----------------|----------------|
|            Operation | # Runs | Minimum (µsec.) | Maximum (µsec.) | Average (µsec.) | Median (µsec.) |
|----------------------|--------|-----------------|-----------------|-----------------|----------------|
|        List Contains |    375 |             0,9 |          2268,5 |           762,1 |         1134,4 |
|        Trie Contains |    375 |             0,6 |            14,3 |             1,9 |            3,5 | <!-- faster
|----------------------|--------|-----------------|-----------------|-----------------|----------------|
|      List StartsWith |     10 |        105232,8 |        131867,3 |        111754,6 |       114549,8 |
|    Trie Find(prefix) |     10 |           117,2 |          8024,5 |          2018,5 |         5734,8 | <!-- slower!
|----------------------|--------|-----------------|-----------------|-----------------|----------------|
|           List Regex |      3 |         79257,9 |         90390,3 |         86020,1 |        90390,3 |
|   Trie Find(pattern) |      3 |         67661,5 |         70327,0 |         68673,7 |        68032,6 | <!-- faster
|----------------------|--------|-----------------|-----------------|-----------------|----------------|

## Node -> NodeReference

### Debug Trace
|--------|------------|--------------|
| Object |    # Nodes |         Size |
|--------|------------|--------------|
|   List |     374614 |   26348248 B |
|--------|------------|--------------|
|   Trie |    1201446 |  368258200 B | <! still too large
|--------|------------|--------------|

|----------------------|--------|-----------------|-----------------|-----------------|----------------|
|            Operation | # Runs | Minimum (µsec.) | Maximum (µsec.) | Average (µsec.) | Median (µsec.) |
|----------------------|--------|-----------------|-----------------|-----------------|----------------|
|        List Contains |    375 |             0,3 |          2387,9 |           791,3 |         1207,1 |
|        Trie Contains |    375 |             0,7 |             4,8 |             2,0 |            2,8 | <!-- OK
|----------------------|--------|-----------------|-----------------|-----------------|----------------|
|      List StartsWith |     10 |        102402,1 |        127504,7 |        109643,7 |       114996,4 |
|    Trie Find(prefix) |     10 |           113,1 |          3256,0 |          1124,6 |         1355,0 | <!-- OK
|----------------------|--------|-----------------|-----------------|-----------------|----------------|
|           List Regex |      3 |         75624,7 |        102018,2 |         91202,3 |        95964,0 |
|   Trie Find(pattern) |      3 |         60130,0 |         63259,4 |         61916,3 |        62359,4 | <!-- Has errors and suffix matching not feasible
|----------------------|--------|-----------------|-----------------|-----------------|----------------|

## Refactoring into flat arrays

### TestContext Messages:
|--------|------------|--------------|
| Object |    # Nodes |         Size |
|--------|------------|--------------|
|   List |     343075 |   24691472 B |
|--------|------------|--------------|
|   ChTr |    1128187 |  321787776 B | <! still too large
|--------|------------|--------------|

|----------------------|--------|-----------------|-----------------|-----------------|----------------|
|            Operation | # Runs | Minimum (µsec.) | Maximum (µsec.) | Average (µsec.) | Median (µsec.) |
|----------------------|--------|-----------------|-----------------|-----------------|----------------|
|        List Contains |    344 |             0,3 |          2941,2 |           660,2 |         1475,7 |
|        ChTr Contains |    344 |             0,2 |             8,6 |             3,2 |            4,1 |
|----------------------|--------|-----------------|-----------------|-----------------|----------------|
|      List StartsWith |     10 |         69354,8 |         97277,3 |         75783,8 |        88010,2 |
|    ChTr Find(prefix) |     10 |            63,8 |          2268,3 |           402,9 |          451,8 |
|----------------------|--------|-----------------|-----------------|-----------------|----------------|
|           List Regex |      3 |         78003,8 |         82749,1 |         80431,5 |        80541,7 |
|   ChTr Find(pattern) |      3 |         31715,0 |         34633,7 |         32932,3 |        32448,2 | <!-- Errors solved; suffix matching feasible
|----------------------|--------|-----------------|-----------------|-----------------|----------------|